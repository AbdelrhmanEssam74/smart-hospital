<h2 class="text-center my-4">Appointments List</h2>
<div class="container">
  <div class="container mb-4">
    <div class="row g-3 align-items-center justify-content-between">
      <div class="col-md-4">
        <label>Date</label>
        <input type="date" class="form-control" [(ngModel)]="filter.date">
      </div>
      <div class="col-md-4">
        <label>Time</label>
        <input type="time" class="form-control" [(ngModel)]="filter.time">
      </div>
      <div class="col-md-4">
        <label>Status</label>
        <select class="form-control" [(ngModel)]="filter.status">
          <option value="">All</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="cancelled">Cancelled</option>
          <option value="completed">Completed</option>
        </select>
      </div>
      <div class="">
        <button class="btn btn-secondary mt-2" (click)="filter = { date: '', time: '', status: '' }">Reset Filters</button>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover text-center">
      <thead class="table-primary">
      <tr>
        <th>Patient</th>
        <th>Gander</th>
        <th>Date</th>
        <th>From</th>
        <th>To</th>
        <th>notes</th>
        <th>Actions</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let appt of filteredAppointments; trackBy: trackById">
        <td>{{ appt.patient?.user?.name }}</td>
        <td>{{ appt.patient?.gender }}</td>
        <td>{{ appt.appointment_date }}</td>
        <td>{{ appt.start_time }}</td>
        <td>{{ appt.end_time }}</td>
        <td>{{ appt.notes }}</td>
        <td>
          <a class="action-btn view-btn" (click)="viewAppointment(appt.id)"><i class="fas fa-eye"></i></a>
          <a class="action-btn accept-btn"
             (click)="acceptAppointment(appt.id, { id: appt.id, status: 'confirmed' }, { date: appt.appointment_date })"
             [class.disabled]="appt.status === 'confirmed'"
             [style.pointerEvents]="appt.status === 'confirmed' ? 'none' : 'auto'"
             [style.opacity]="appt.status === 'confirmed' ? 0.5 : 1">
            <i class="fas fa-check"></i>
          </a>

          <a class="action-btn delete-btn"
             (click)="CancelledAppointment(appt.id, appt.appointment_date, appt.status)"
             [class.disabled]="appt.status === 'confirmed' || isPastAppointment(appt.appointment_date)"
             [style.pointerEvents]="(appt.status === 'confirmed' || isPastAppointment(appt.appointment_date)) ? 'none' : 'auto'"
             [style.opacity]="(appt.status === 'confirmed' || isPastAppointment(appt.appointment_date)) ? 0.5 : 1">
            <i class="fas fa-times"></i>
          </a>


        </td>
        <td>
    <span class="badge" [ngClass]="{
      'bg-success': appt.status === 'confirmed',
      'bg-warning': appt.status === 'pending',
      'bg-danger': appt.status === 'cancelled'
    }">
      {{ appt.status }}
    </span>
        </td>
      </tr>
      <tr *ngIf="filteredAppointments.length === 0">
        <td colspan="8">No appointments match your filters.</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div *ngIf="showPopup" class="popup-overlay">
  <div class="popup-box">
    <h3 class="text-primary">Appointment Details</h3>
    <p><strong>Patient:</strong> {{ selectedAppointment?.patientName }}</p>
    <p><strong>Gender:</strong> {{ selectedAppointment?.gender }}</p>
    <p><strong>Date:</strong> {{ selectedAppointment?.date }}</p>
    <p><strong>From:</strong> {{ selectedAppointment?.startTime }}</p>
    <p><strong>To:</strong> {{ selectedAppointment?.endTime }}</p>
    <p><strong>Notes:</strong> {{ selectedAppointment?.notes }}</p>
    <p><strong>Status:</strong> {{ selectedAppointment?.status }}</p>
    <button (click)="closePopup()">Close</button>
  </div>
</div>

